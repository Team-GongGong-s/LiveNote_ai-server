#!/bin/bash

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# QA Generate RAG 검증 테스트
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

BASE_URL="http://localhost:8000"
API_ENDPOINT="/qa/generate"

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "🧪 QA Generate RAG 검증 테스트"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 테스트 1: CS101 - 알고리즘 시간 복잡도 관련 QA 생성
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
echo "📝 테스트 1: CS101 - 알고리즘 시간 복잡도"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "💡 Summary: 알고리즘의 효율성을 분석하는 방법에 대해 학습합니다. Big-O 표기법을 사용하여 시간 복잡도를 표현하며, O(1), O(log n), O(n), O(n log n), O(n^2) 등 다양한 복잡도를 비교합니다."
echo "🎯 예상 RAG: algo_complexity 청크 (시간 복잡도 관련)"
echo ""

curl -N -X POST "${BASE_URL}${API_ENDPOINT}" \
  -H "Content-Type: application/json" \
  -d '{
    "lecture_id": "cs101",
    "section_id": 1,
    "section_summary": "알고리즘의 효율성을 분석하는 방법에 대해 학습합니다. Big-O 표기법을 사용하여 시간 복잡도를 표현하며, O(1), O(log n), O(n), O(n log n), O(n^2) 등 다양한 복잡도를 비교합니다.",
    "subject": "컴퓨터 과학"
  }'

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
sleep 2

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 테스트 2: CS101 - 자료구조 그래프
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
echo "📝 테스트 2: CS101 - 자료구조 그래프"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "💡 Summary: 그래프는 노드와 엣지로 구성된 비선형 자료구조입니다. 정점(Vertex)과 간선(Edge)의 개념을 이해하고, 최단 경로, 네트워크 분석, 소셜 네트워크 등 다양한 응용 분야를 학습합니다."
echo "🎯 예상 RAG: graph_def 청크 (그래프 정의 및 응용)"
echo ""

curl -N -X POST "${BASE_URL}${API_ENDPOINT}" \
  -H "Content-Type: application/json" \
  -d '{
    "lecture_id": "cs101",
    "section_id": 5,
    "section_summary": "그래프는 노드와 엣지로 구성된 비선형 자료구조입니다. 정점(Vertex)과 간선(Edge)의 개념을 이해하고, 최단 경로, 네트워크 분석, 소셜 네트워크 등 다양한 응용 분야를 학습합니다.",
    "subject": "컴퓨터 과학"
  }'

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
sleep 2

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 테스트 3: MATH201 - 미적분 도함수
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
echo "📝 테스트 3: MATH201 - 미적분 도함수"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "💡 Summary: 도함수는 함수의 순간 변화율을 나타냅니다. 극한의 개념을 사용하여 정의하며, 미분 계수를 계산하는 다양한 공식을 학습합니다. 실생활에서 속도, 가속도 등을 계산하는 데 활용됩니다."
echo "🎯 예상 RAG: calc_derivative 청크 (도함수 정의 및 공식)"
echo ""

curl -N -X POST "${BASE_URL}${API_ENDPOINT}" \
  -H "Content-Type: application/json" \
  -d '{
    "lecture_id": "math201",
    "section_id": 1,
    "section_summary": "도함수는 함수의 순간 변화율을 나타냅니다. 극한의 개념을 사용하여 정의하며, 미분 계수를 계산하는 다양한 공식을 학습합니다. 실생활에서 속도, 가속도 등을 계산하는 데 활용됩니다.",
    "subject": "수학"
  }'

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
sleep 2

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 테스트 4: MATH201 - 적분 공식
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
echo "📝 테스트 4: MATH201 - 적분 공식"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "💡 Summary: 삼각함수의 적분은 특수한 공식이 필요합니다. sin, cos, tan 등의 적분 공식을 학습하고, 삼각 치환을 활용한 적분 기법을 익힙니다. 주기 함수의 적분 계산에 활용됩니다."
echo "🎯 예상 RAG: 삼각함수 적분 관련 청크"
echo ""

curl -N -X POST "${BASE_URL}${API_ENDPOINT}" \
  -H "Content-Type: application/json" \
  -d '{
    "lecture_id": "math201",
    "section_id": 3,
    "section_summary": "삼각함수의 적분은 특수한 공식이 필요합니다. sin, cos, tan 등의 적분 공식을 학습하고, 삼각 치환을 활용한 적분 기법을 익힙니다. 주기 함수의 적분 계산에 활용됩니다.",
    "subject": "수학"
  }'

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# 요약
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "✅ 모든 테스트 완료!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "📊 테스트 요약:"
echo "   - 총 4개 테스트 케이스"
echo "   - 2개 강의 (cs101, math201)"
echo "   - 각 강의별 2개 섹션"
echo ""
echo "🔍 RAG 검색 확인 방법:"
echo "   1. 서버 터미널에서 🔍 RAG 검색 결과 확인"
echo "   2. Retrieved chunks와 score 확인"
echo "   3. Metadata에서 어떤 청크가 검색되었는지 확인"
echo ""
echo "💡 설정:"
echo "   - qa_retrieve_top_k: 2 (기본값)"
echo "   - 각 요청마다 2개 청크 검색"
echo "   - Score: 벡터 유사도 (높을수록 관련성 높음)"
echo ""
